<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç½å®³æ‰‹ç¶šãã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥</title>
    <style>
        /* --- ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« --- */
        :root {
            --primary-color: #3182ce;
            --bg-color: #f7fafc;
            --text-color: #2d3748;
            --card-bg: #ffffff;
            --yes-color: #48bb78;
            --no-color: #f56565;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            height: 100vh;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ï¼ˆã‚¢ãƒ—ãƒªã£ã½ãï¼‰ */
            color: var(--text-color);
            display: flex;
            flex-direction: column;
        }

        /* --- ç”»é¢é·ç§»ç®¡ç† --- */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            box-sizing: border-box;
            padding: 20px;
            overflow-y: auto;
        }

        .screen.active {
            display: flex;
        }

        h1 {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        p.desc {
            font-size: 0.9rem;
            color: #718096;
            text-align: center;
            margin-bottom: 20px;
        }

        /* --- Step 1: å€‹äººæƒ…å ±å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  --- */
        .form-group {
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            background: #fff;
            box-sizing: border-box; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
        }

        .start-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            width: 100%;
            margin-top: auto; /* ä¸‹éƒ¨ã«é…ç½® */
            box-shadow: 0 4px 6px rgba(50, 130, 200, 0.3);
            transition: transform 0.1s;
        }

        .start-btn:active {
            transform: scale(0.98);
        }

        /* --- Loading Animation --- */
        #loading-screen {
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Step 2: ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ --- */
        .card-container {
            position: relative;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            width: 100%;
        }

        .card {
            position: absolute;
            width: 90vw; /* ã‚¹ãƒãƒ›å¹…ã®90% */
            max-width: 340px;
            height: 60vh; /* é«˜ã•ã®60% */
            max-height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            cursor: grab;
            user-select: none;
            touch-action: none; /* ã‚¹ãƒ¯ã‚¤ãƒ—æ™‚ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
            transform-origin: 50% 100%;
        }

        .card-icon { font-size: 4rem; margin-bottom: 20px; }
        .card-title { font-size: 1.4rem; font-weight: bold; text-align: center; margin-bottom: 10px; line-height: 1.3; }
        .card-desc { font-size: 0.95rem; text-align: center; color: #718096; line-height: 1.6; }
        .card-tag { 
            position: absolute; bottom: 20px;
            background: #edf2f7; padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; color: #4a5568; 
        }

        /* ã‚¹ã‚¿ãƒ³ãƒ— */
        .stamp {
            position: absolute; top: 30px; padding: 5px 10px;
            border: 3px solid; border-radius: 8px; font-size: 1.8rem; font-weight: 900;
            opacity: 0; pointer-events: none;
        }
        .stamp-nope { right: 30px; color: var(--no-color); border-color: var(--no-color); transform: rotate(15deg); }
        .stamp-like { left: 30px; color: var(--yes-color); border-color: var(--yes-color); transform: rotate(-15deg); }

        .controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding-bottom: 20px;
        }
        .ctrl-btn {
            width: 65px; height: 65px; border-radius: 50%; border: none; font-size: 1.8rem;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex; justify-content: center; align-items: center;
            transition: transform 0.1s;
        }
        .ctrl-btn:active { transform: scale(0.9); }
        .btn-no { background: white; color: var(--no-color); }
        .btn-yes { background: var(--yes-color); color: white; }

        /* --- Step 3: çµæœãƒªã‚¹ãƒˆ --- */
        .result-list { flex-grow: 1; overflow-y: auto; padding-bottom: 20px; }
        .todo-item {
            background: white; border-left: 6px solid var(--yes-color);
            padding: 15px; margin-bottom: 15px; border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .todo-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; }
        .todo-details { font-size: 0.9rem; color: #4a5568; }
        .todo-tag { display: inline-block; font-size: 0.75rem; background: #e2e8f0; padding: 2px 8px; border-radius: 4px; margin-top: 5px; }

    </style>
</head>
<body>

    <div id="screen-onboarding" class="screen active">
        <header>
            <h1>çŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„</h1>
            <p class="desc">30ç§’ã§AIãŒã‚ãªãŸã«å¿…è¦ãª<br>æ‰‹ç¶šãã ã‘ã‚’é¸ã³å‡ºã—ã¾ã™ã€‚</p>
        </header>
        
        <form id="profile-form">
            <div class="form-group">
                <label>ğŸ  ä½ã¾ã„ã®è¢«å®³çŠ¶æ³</label>
                <select id="input-house-status">
                    <option value="none">è¢«å®³ãªã—ãƒ»è»½å¾®</option>
                    <option value="damage">ä¸€éƒ¨æå£Šã€œå…¨å£Š</option>
                </select>
            </div>
            <div class="form-group">
                <label>ğŸ”‘ ä½ã¾ã„ã®æ¨©åˆ©</label>
                <select id="input-house-type">
                    <option value="rent">è³ƒè²¸ï¼ˆã‚¢ãƒ‘ãƒ¼ãƒˆãƒ»å€Ÿå®¶ï¼‰</option>
                    <option value="own">æŒã¡å®¶</option>
                </select>
            </div>
            <div class="form-group">
                <label>ğŸ’¼ ç¾åœ¨ã®ãŠä»•äº‹</label>
                <select id="input-job">
                    <option value="employee">ä¼šç¤¾å“¡ãƒ»å…¬å‹™å“¡</option>
                    <option value="self">è‡ªå–¶æ¥­ãƒ»ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹</option>
                    <option value="none">ç„¡è·ãƒ»å­¦ç”Ÿ</option>
                </select>
            </div>
            <div class="form-group">
                <label>ğŸš— è»Šã®è¢«å®³</label>
                <select id="input-car">
                    <option value="no">ãªã—ï¼ˆè»Šã‚’æŒã£ã¦ã„ãªã„/ç„¡äº‹ï¼‰</option>
                    <option value="yes">ã‚ã‚Šï¼ˆæ°´æ²¡ãƒ»æå£Šãªã©ï¼‰</option>
                </select>
            </div>
        </form>

        <button class="start-btn" onclick="processAI()">ãƒã‚§ãƒƒã‚¯ã‚’é–‹å§‹ã™ã‚‹</button>
    </div>

    <div id="loading-screen" class="screen">
        <div class="spinner"></div>
        <p>AIãŒæœ€é©ãªæ‰‹ç¶šãã‚’æ¤œç´¢ä¸­...</p>
    </div>

    <div id="screen-swiping" class="screen">
        <header style="margin-top: 10px;">
            <h1>æ‰‹ç¶šãä»•åˆ†ã‘</h1>
            <p class="desc">ç›´æ„Ÿã§é¸ã‚“ã§ãã ã•ã„</p>
        </header>

        <div class="card-container" id="cardContainer">
            </div>

        <div class="controls">
            <button class="ctrl-btn btn-no" onclick="manualSwipe('left')">âœ•</button>
            <button class="ctrl-btn btn-yes" onclick="manualSwipe('right')">âœ“</button>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <header>
            <h1>ã‚ãªãŸã®ToDoãƒªã‚¹ãƒˆ</h1>
            <p class="desc">å„ªå…ˆåº¦ã®é«˜ã„é †ã«è¡¨ç¤ºã—ã¦ã„ã¾ã™</p>
        </header>

        <div class="result-list" id="todo-list">
            </div>

        <button class="start-btn" onclick="location.reload()" style="background-color: #718096;">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
    </div>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆç½å®³æ‰‹ç¶šãã®å…¨é‡ãƒ‡ãƒ¼ã‚¿ï¼‰ ---
    // conditioné–¢æ•°ã§ã€ãã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¶å¾¡ã—ã¾ã™
    const allDatabase = [
        {
            id: 'risai',
            title: "ã‚Šç½è¨¼æ˜æ›¸",
            desc: "å…¨ã¦ã®æ”¯æ´ã®åŸºç¤ã¨ãªã‚‹æ›¸é¡ã§ã™ã€‚å®¶ã®è¢«å®³å†™çœŸã‚’æ’®ã£ã¦ã‹ã‚‰ç”³è«‹ã—ã¦ãã ã•ã„ã€‚",
            icon: "ğŸ“„",
            tag: "è¡Œæ”¿ / æœ€å„ªå…ˆ",
            action: "å¸‚ç”ºæ‘çª“å£ã§ç”³è«‹",
            condition: (p) => p.houseStatus === 'damage'
        },
        {
            id: 'hoken',
            title: "ç«ç½ãƒ»åœ°éœ‡ä¿é™ºã®è«‹æ±‚",
            desc: "å®¶ã®è¢«å®³çŠ¶æ³ã‚’ä¿é™ºä¼šç¤¾ã«é€£çµ¡ã—ã¾ã™ã€‚ç‰‡ä»˜ã‘ã‚‹å‰ã«å†™çœŸã‚’æ’®ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚",
            icon: "ğŸ ",
            tag: "æ°‘é–“ / ãŠé‡‘",
            action: "ä¿é™ºä¼šç¤¾ã¸é›»è©±/WEB",
            condition: (p) => p.houseStatus === 'damage'
        },
        {
            id: 'oukyu',
            title: "ä½å®…ã®å¿œæ€¥ä¿®ç†åˆ¶åº¦",
            desc: "å±‹æ ¹ã‚„å£ãªã©ã€ä½ã‚€ãŸã‚ã«æœ€ä½é™å¿…è¦ãªä¿®ç†è²»ç”¨ã‚’è¡Œæ”¿ãŒè£œåŠ©ã™ã‚‹åˆ¶åº¦ã§ã™ã€‚",
            icon: "ğŸ”¨",
            tag: "è¡Œæ”¿ / ä½ã¾ã„",
            action: "å¸‚ç”ºæ‘çª“å£ã¸ç›¸è«‡ï¼ˆä¿®ç†ä¾é ¼å‰ï¼‰",
            condition: (p) => p.houseStatus === 'damage' && p.houseType === 'own'
        },
        {
            id: 'shienkin',
            title: "è¢«ç½è€…ç”Ÿæ´»å†å»ºæ”¯æ´é‡‘",
            desc: "ä½å®…ãŒå…¨å£Šç­‰ã®å ´åˆã€æœ€å¤§300ä¸‡å††ãŒæ”¯çµ¦ã•ã‚Œã¾ã™ã€‚",
            icon: "ğŸ’´",
            tag: "è¡Œæ”¿ / æ”¯æ´é‡‘",
            action: "ã‚Šç½è¨¼æ˜æ›¸å–å¾—å¾Œã«ç”³è«‹",
            condition: (p) => p.houseStatus === 'damage'
        },
        {
            id: 'car_tax',
            title: "è‡ªå‹•è»Šé‡é‡ç¨ã®é‚„ä»˜",
            desc: "è¢«ç½ã—ã¦å»ƒè»Šã«ã—ãŸå ´åˆã€è»Šæ¤œã®æ®‹ã‚ŠæœŸé–“åˆ†ã®ç¨é‡‘ãŒæˆ»ã£ã¦ãã¾ã™ã€‚",
            icon: "ğŸš—",
            tag: "ç¨é‡‘ / è»Š",
            action: "é™¸é‹æ”¯å±€ç­‰ã§æ‰‹ç¶šã",
            condition: (p) => p.car === 'yes'
        },
        {
            id: 'koyou',
            title: "å¤±æ¥­æ‰‹å½“ã®ç‰¹ä¾‹å—çµ¦",
            desc: "ç½å®³ã«ã‚ˆã‚Šäº‹æ¥­æ‰€ãŒä¼‘æ¥­ã—ã€ä¸€æ™‚çš„ã«åƒã‘ãªã„å ´åˆã‚‚å—çµ¦ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            icon: "ğŸ‘·",
            tag: "ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚¯ / ä»•äº‹",
            action: "ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚¯ã¸ç›¸è«‡",
            condition: (p) => p.job === 'employee'
        },
        {
            id: 'kouko',
            title: "ç½å®³è²¸ä»˜ï¼ˆå…¬åº«ãªã©ï¼‰",
            desc: "äº‹æ¥­å†å»ºã®ãŸã‚ã®ä½é‡‘åˆ©èè³‡åˆ¶åº¦ã§ã™ã€‚",
            icon: "ğŸ“‰",
            tag: "é‡‘è / äº‹æ¥­",
            action: "æ—¥æœ¬æ”¿ç­–é‡‘èå…¬åº«ã¸ç›¸è«‡",
            condition: (p) => p.job === 'self'
        },
        {
            id: 'tax_red',
            title: "ç¨é‡‘ãƒ»ä¿é™ºæ–™ã®æ¸›å…",
            desc: "ä½æ°‘ç¨ã‚„å›½æ°‘å¥åº·ä¿é™ºæ–™ãªã©ãŒæ¸›å…ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
            icon: "ğŸ‘›",
            tag: "è¡Œæ”¿ / ãŠé‡‘",
            action: "å¸‚ç”ºæ‘çª“å£ã¸ç›¸è«‡",
            condition: (p) => true // å…¨å“¡å¯¾è±¡
        },
        {
            id: 'nhk',
            title: "NHKå—ä¿¡æ–™ã®å…é™¤",
            desc: "ç½å®³æ•‘åŠ©æ³•ãŒé©ç”¨ã•ã‚ŒãŸåœ°åŸŸã§ã€ä½å±…ã«è¢«å®³ãŒã‚ã£ãŸå ´åˆã«å…é™¤ã•ã‚Œã¾ã™ã€‚",
            icon: "ğŸ“º",
            tag: "ç”Ÿæ´»",
            action: "NHKã¸é€£çµ¡",
            condition: (p) => p.houseStatus === 'damage'
        }
    ];

    let currentStack = []; // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã®ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
    let myTodoList = [];   // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œå¿…è¦ï¼ˆYESï¼‰ã€ã—ãŸãƒªã‚¹ãƒˆ

    // --- ç”»é¢é·ç§»é–¢æ•° ---
    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- Step 1: AIå‡¦ç†ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰ ---
    function processAI() {
        // 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å–å¾—
        const profile = {
            houseStatus: document.getElementById('input-house-status').value,
            houseType: document.getElementById('input-house-type').value,
            job: document.getElementById('input-job').value,
            car: document.getElementById('input-car').value
        };

        // 2. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        switchScreen('loading-screen');

        // 3. AIæ€è€ƒæ™‚é–“ã®æ¼”å‡º (1.5ç§’å¾…æ©Ÿ)
        setTimeout(() => {
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œ
            currentStack = allDatabase.filter(card => card.condition(profile));
            
            // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
            initCards(currentStack);
            
            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            switchScreen('screen-swiping');
        }, 1500);
    }

    // --- Step 2: ã‚«ãƒ¼ãƒ‰UIã®ç”Ÿæˆã¨æ“ä½œ ---
    const container = document.getElementById('cardContainer');

    function initCards(cards) {
        container.innerHTML = ''; // ã‚¯ãƒªã‚¢
        
        if (cards.length === 0) {
            container.innerHTML = '<div style="text-align:center">è©²å½“ã™ã‚‹æ‰‹ç¶šããŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>å¸‚ç”ºæ‘ã®ç·åˆçª“å£ã¸ã”ç›¸è«‡ãã ã•ã„ã€‚</div>';
            return;
        }

        cards.forEach((data, index) => {
            const card = document.createElement('div');
            card.classList.add('card');
            // Z-index: æœ€å¾ŒãŒä¸€ç•ªä¸Šã«æ¥ã‚‹ã‚ˆã†ã«ï¼ˆè¡¨ç¤ºé †åºã®èª¿æ•´ï¼‰
            card.style.zIndex = cards.length - index;
            
            // ãƒ‡ãƒ¼ã‚¿åŸ‹ã‚è¾¼ã¿ï¼ˆIDç‰¹å®šç”¨ï¼‰
            card.dataset.id = data.id;

            card.innerHTML = `
                <div class="stamp stamp-like">å¿…è¦</div>
                <div class="stamp stamp-nope">ä¸è¦</div>
                <div class="card-icon">${data.icon}</div>
                <div class="card-title">${data.title}</div>
                <div class="card-desc">${data.desc}</div>
                <div class="card-tag">${data.tag}</div>
            `;
            
            container.appendChild(card);
            addSwipeLogic(card, data);
        });
    }

    // --- ã‚¹ãƒ¯ã‚¤ãƒ—åˆ¶å¾¡ (Touch & Mouse) ---
    function addSwipeLogic(card, data) {
        let isDragging = false;
        let startX = 0;
        let currentX = 0;

        const start = (x) => {
            isDragging = true;
            startX = x;
            card.style.transition = 'none';
        };

        const move = (x) => {
            if (!isDragging) return;
            currentX = x - startX;
            const rotate = currentX * 0.05; // å›è»¢ä¿‚æ•°
            
            card.style.transform = `translateX(${currentX}px) rotate(${rotate}deg)`;

            // ã‚¹ã‚¿ãƒ³ãƒ—ã®é€æ˜åº¦åˆ¶å¾¡
            const like = card.querySelector('.stamp-like');
            const nope = card.querySelector('.stamp-nope');
            
            if (currentX > 0) {
                like.style.opacity = Math.min(currentX / 100, 1);
                nope.style.opacity = 0;
            } else {
                nope.style.opacity = Math.min(Math.abs(currentX) / 100, 1);
                like.style.opacity = 0;
            }
        };

        const end = () => {
            if (!isDragging) return;
            isDragging = false;
            const threshold = 100; // ã—ãã„å€¤

            if (currentX > threshold) {
                swipeOut(card, 'right', data);
            } else if (currentX < -threshold) {
                swipeOut(card, 'left', data);
            } else {
                // å…ƒã«æˆ»ã™
                card.style.transition = 'transform 0.3s ease-out';
                card.style.transform = `translateX(0px) rotate(0deg)`;
                card.querySelector('.stamp-like').style.opacity = 0;
                card.querySelector('.stamp-nope').style.opacity = 0;
            }
            currentX = 0;
        };

        // Mouse Events
        card.addEventListener('mousedown', e => start(e.clientX));
        document.addEventListener('mousemove', e => move(e.clientX));
        document.addEventListener('mouseup', end);

        // Touch Events
        card.addEventListener('touchstart', e => start(e.touches[0].clientX));
        document.addEventListener('touchmove', e => move(e.touches[0].clientX));
        document.addEventListener('touchend', end);
    }

    function swipeOut(card, direction, data) {
        const moveX = direction === 'right' ? 1000 : -1000;
        const rotate = direction === 'right' ? 30 : -30;
        
        card.style.transition = 'transform 0.5s ease-out';
        card.style.transform = `translateX(${moveX}px) rotate(${rotate}deg)`;

        // ãƒ­ã‚¸ãƒƒã‚¯å‡¦ç†
        if (direction === 'right') {
            myTodoList.push(data);
        }

        // ã‚«ãƒ¼ãƒ‰é™¤å»ã¨çµ‚äº†åˆ¤å®š
        setTimeout(() => {
            card.remove(); // DOMã‹ã‚‰å‰Šé™¤
            checkFinish();
        }, 300);
    }

    // ãƒœã‚¿ãƒ³æ“ä½œç”¨
    window.manualSwipe = (direction) => {
        const cards = document.querySelectorAll('.card');
        if (cards.length === 0) return;

        // z-indexãŒä¸€ç•ªé«˜ã„ï¼ˆï¼æ‰‹å‰ã«ã‚ã‚‹ï¼‰ã‚«ãƒ¼ãƒ‰ã‚’æ¢ã™
        // ä»Šå›ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã§ã¯DOMã®å…ˆé ­ãŒä¸€ç•ªä¸Šã¨ã¯é™ã‚‰ãªã„ã®ã§ã‚½ãƒ¼ãƒˆã™ã‚‹
        const topCard = Array.from(cards).reduce((prev, current) => {
            return (Number(prev.style.zIndex) > Number(current.style.zIndex)) ? prev : current;
        });

        const id = topCard.dataset.id;
        const data = currentStack.find(d => d.id === id);

        swipeOut(topCard, direction, data);
    };

    function checkFinish() {
        const remaining = document.querySelectorAll('.card');
        if (remaining.length === 0) {
            renderResult();
            switchScreen('screen-result');
        }
    }

    // --- Step 3: çµæœè¡¨ç¤º ---
    function renderResult() {
        const listEl = document.getElementById('todo-list');
        listEl.innerHTML = '';

        if (myTodoList.length === 0) {
            listEl.innerHTML = '<div style="text-align:center; padding:20px;">å¿…è¦ãªæ‰‹ç¶šãã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>ã‚†ã£ãã‚ŠãŠä¼‘ã¿ãã ã•ã„ã€‚</div>';
            return;
        }

        myTodoList.forEach(item => {
            const div = document.createElement('div');
            div.classList.add('todo-item');
            div.innerHTML = `
                <div class="todo-title">âœ… ${item.title}</div>
                <div class="todo-details">${item.desc}</div>
                <div style="margin-top:8px; font-weight:bold; color:#2b6cb0;">Next: ${item.action}</div>
                <div class="todo-tag">${item.tag}</div>
            `;
            listEl.appendChild(div);
        });
    }

</script>
</body>
</html>